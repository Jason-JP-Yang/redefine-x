const e=new WeakSet;let r=null;function loadImage(e,r){return new Promise(((o,a)=>{const t=new Image;t.alt=r,function isSameOrigin(e){try{return new URL(e,window.location.href).origin===window.location.origin}catch{return!1}}(e)&&(t.crossOrigin="anonymous"),t.onload=()=>o(t),t.onerror=()=>a(new Error(`Failed to load: ${e}`)),t.src=e}))}async function processPreloader(r){if(e.has(r))return;e.add(r);const o=r.dataset.src,a=r.dataset.alt||"";try{!function replacePreloader(e,r){Array.from(e.classList).filter((e=>!e.startsWith("img-preloader"))).forEach((e=>r.classList.add(e)));const o=e.dataset.width,a=e.dataset.height;o&&(r.width=parseInt(o,10)),a&&(r.height=parseInt(a,10)),r.classList.add("img-preloader-loaded"),r.dataset.originalSrc=e.dataset.src,e.classList.add("img-preloader-fade-out"),setTimeout((()=>{e.parentNode?.replaceChild(r,e)}),200)}(r,await loadImage(o,a))}catch(e){console.error("[lazyload]",e),function showError(e,r){e.classList.add("img-preloader-error");const o=e.querySelector(".img-preloader-skeleton");o&&(o.innerHTML=`\n      <i class="fa-solid fa-circle-xmark img-preloader-error-icon"></i>\n      <div class="img-preloader-error-text">\n        <div class="error-message">Failed to load image</div>\n        <div class="error-url">${r}</div>\n      </div>\n    `)}(r,o)}}export default function initLazyLoad(){const e=document.querySelectorAll(".img-preloader:not([data-observed])");if(0===e.length)return;const o=function getObserver(){return r||(r=new IntersectionObserver((e=>{e.forEach((e=>{e.isIntersecting&&(r.unobserve(e.target),processPreloader(e.target))}))}),{rootMargin:"100px",threshold:.01})),r}();e.forEach((e=>{e.dataset.observed="true",o.observe(e)}))}export function forceLoadAllPreloaders(){document.querySelectorAll(".img-preloader").forEach(processPreloader)}
//# sourceMappingURL=lazyload.js.map