!function(){function checkLayout(e){e.dataset.originalLayout||(e.classList.contains("image-exif-float")?e.dataset.originalLayout="float":(e.classList.contains("image-exif-block"),e.dataset.originalLayout="block"));const t=e.querySelector(".image-exif-info-card"),i=function checkSideLayout(e){const t=e.querySelector(".image-exif-image-wrapper"),i=e.querySelector(".image-exif-info-card");if(!t||!i)return!1;const a=t.querySelector("img.image-exif-img"),o=t.querySelector(".img-preloader");let n=0,s=0;if(a&&a.complete&&a.naturalHeight>0?(n=a.offsetHeight||a.clientHeight,s=a.offsetWidth||a.clientWidth):o&&(n=o.offsetHeight||o.clientHeight,s=o.offsetWidth||o.clientWidth),0===n||0===s)return!1;const l=e.getBoundingClientRect().width,r=l-s-24-10;if(r>=130){const t=i.cloneNode(!0);t.classList.remove("expanded");const a=Math.min(r,400),o=window.getComputedStyle(i);Object.assign(t.style,{display:"block",visibility:"hidden",position:"absolute",top:"0",left:"0",width:a+"px",height:"auto",maxHeight:"none",zIndex:"-9999",padding:o.padding,border:o.border,boxSizing:o.boxSizing,fontSize:o.fontSize,fontFamily:o.fontFamily,lineHeight:o.lineHeight});const s=t.querySelector(".image-exif-data");s&&Object.assign(s.style,{display:"grid",height:"auto",marginTop:"0.6rem",gridTemplateColumns:"repeat(auto-fit, minmax(130px, 1fr))"});const l=t.querySelector(".image-exif-toggle-btn");l&&(l.style.display="none"),e.appendChild(t);const c=t.offsetHeight;if(e.removeChild(t),c<=1.1*n)return e.classList.contains("image-exif-side")||(e.classList.add("image-exif-side"),e.classList.remove("image-exif-overflow-fallback"),i.style.display="",i.style.visibility="",i.style.opacity=""),i.style.maxWidth=a+"px",i.querySelector(".image-exif-data")&&(i.querySelector(".image-exif-data").style.gridTemplateColumns=""),!0}return!1}(e);i||(e.classList.contains("image-exif-side")&&e.classList.remove("image-exif-side"),t&&(t.style.maxWidth="",t.querySelector(".image-exif-data")&&(t.querySelector(".image-exif-data").style.gridTemplateColumns="")),"float"===e.dataset.originalLayout?function checkFloatLayout(e){if(e.classList.contains("image-exif-side"))return;const t=e.querySelector(".image-exif-image-wrapper"),i=e.querySelector(".image-exif-info-card");if(!t||!i)return;const a=t.querySelector("img.image-exif-img"),o=t.querySelector(".img-preloader");let n=0;if(a&&a.complete&&a.naturalHeight>0?n=a.offsetHeight||a.clientHeight:o&&(n=o.offsetHeight||o.clientHeight),0===n)return;i.querySelectorAll(".image-exif-item").length;const s=i.cloneNode(!0);s.classList.remove("expanded");const l=window.getComputedStyle(i);Object.assign(s.style,{display:"block",visibility:"hidden",position:"absolute",top:"0",left:"0",width:"max-content",maxWidth:"60%",height:"auto",maxHeight:"none",overflow:"visible",background:"transparent",zIndex:"-9999",padding:l.padding,border:l.border,boxSizing:l.boxSizing,fontSize:l.fontSize,fontFamily:l.fontFamily,lineHeight:l.lineHeight});const r=s.querySelector(".image-exif-data"),c=s.querySelector(".image-exif-toggle-btn");c&&(c.style.display="none"),t.appendChild(s);const d=n-24;let g=1,f=99999;const m=.6*t.offsetWidth-22;let u=Math.floor((m+10)/190);var y;u=Math.max(1,Math.min(4,u)),y=u,f=r?(Object.assign(r.style,{display:"grid",height:"auto",opacity:"1",marginTop:"0.6rem",gridTemplateColumns:`repeat(${y}, minmax(180px, 1fr))`,gap:"0.6rem"}),Math.max(s.offsetHeight,s.scrollHeight)):99999,g=u,t.removeChild(s),f>d-2?e.classList.contains("image-exif-overflow-fallback")||(e.classList.add("image-exif-overflow-fallback"),i.querySelector(".image-exif-data")&&(i.querySelector(".image-exif-data").style.gridTemplateColumns=""),i.style.display="",i.style.visibility="",i.style.opacity=""):(e.classList.contains("image-exif-overflow-fallback")&&(i.style.transition="none",e.classList.remove("image-exif-overflow-fallback"),i.offsetHeight,i.style.transition=""),i.querySelector(".image-exif-data")&&(i.querySelector(".image-exif-data").style.gridTemplateColumns=`repeat(${g}, minmax(180px, 1fr))`))}(e):(e.classList.contains("image-exif-overflow-fallback")&&e.classList.remove("image-exif-overflow-fallback"),t&&(t.style.display="",t.style.visibility="",t.style.opacity="")))}const e=new ResizeObserver((e=>{for(const t of e)requestAnimationFrame((()=>{t.target.classList.contains("image-exif-container")&&checkLayout(t.target)}))}));function initImageExif(){document.querySelectorAll(".image-exif-container").forEach((t=>{if(t.dataset.imageExifInit)return;t.dataset.imageExifInit="true",e.observe(t);t.querySelectorAll(".image-exif-toggle-btn").forEach((e=>{e.addEventListener("click",(t=>{t.stopPropagation(),function handleToggle(e){const t=e.closest(".image-exif-info-card");if(!t)return;const i=t.querySelector(".image-exif-data");if(!i)return;t.classList.contains("expanded")?(i.style.height=i.scrollHeight+"px",i.offsetHeight,t.classList.remove("expanded"),i.style.height="0"):(i.style.height="0px",i.offsetHeight,t.classList.add("expanded"),i.style.height=i.scrollHeight+"px",i.addEventListener("transitionend",(function(){t.classList.contains("expanded")&&(i.style.height="auto")}),{once:!0}))}(e)}))})),checkLayout(t),setTimeout((()=>checkLayout(t)),300);t.querySelectorAll("img.image-exif-img").forEach((e=>{e.complete||e.addEventListener("load",(()=>{checkLayout(t)}))}));const i=t.querySelector(".image-exif-image-wrapper");if(i&&i.querySelector(".img-preloader")){new MutationObserver((e=>{e.forEach((e=>{e.addedNodes.forEach((e=>{"IMG"===e.tagName&&(e.complete?requestAnimationFrame((()=>checkLayout(t))):e.addEventListener("load",(()=>{checkLayout(t)})))}))}))})).observe(i,{childList:!0})}}))}function handleResize(){document.querySelectorAll(".image-exif-container").forEach((e=>{checkLayout(e)}))}let t,i=!1;function debouncedResize(){i||(clearTimeout(t),t=setTimeout((()=>{i||(i=!0,requestAnimationFrame((()=>{handleResize(),i=!1})))}),150))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initImageExif):initImageExif(),document.addEventListener("swup:contentReplaced",initImageExif),document.addEventListener("pjax:complete",initImageExif);try{"undefined"!=typeof swup&&swup?.hooks?.on&&swup.hooks.on("page:view",(()=>{initImageExif(),setTimeout(initImageExif,50)}))}catch(e){}window.addEventListener("resize",debouncedResize);const a=document.querySelector(".page-aside-toggle");a&&a.addEventListener("click",(()=>{setTimeout(handleResize,300)})),window.addEventListener("redefine:force-exif-check",debouncedResize),window.addEventListener("redefine:image-loaded",(e=>{const t=e.detail?.img;if(t){const e=t.closest(".image-exif-container");e&&requestAnimationFrame((()=>checkLayout(e)))}}))}();
//# sourceMappingURL=imageExif.js.map