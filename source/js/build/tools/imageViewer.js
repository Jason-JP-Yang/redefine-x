export default function imageViewer(){if(window.__REDEFINE_X_IMAGE_VIEWER_INITIALIZED__)return;window.__REDEFINE_X_IMAGE_VIEWER_INITIALIZED__=!0;const e=document.querySelector(".image-viewer-container");if(!e)return void console.warn("Image viewer container not found.");const t=e.querySelector("img");t&&(t.src="data:,",t.alt="",t.style.display="none");const n=(()=>{const t=e.querySelector(".image-viewer-stage");if(t)return t;const n=document.createElement("div");return n.className="image-viewer-stage",e.appendChild(n),n})(),a={isOpen:!1,currentIndex:-1,items:[],activeImg:null,placeholder:null,scale:1,translateX:0,translateY:0,isMouseDown:!1,dragged:!1,lastMouseX:0,lastMouseY:0},s=".markdown-body img, .masonry-item img, #shuoshuo-content img";function isViewableImg(e){return!!e&&(!e.closest(".image-viewer-container")&&(!(!e.complete||!e.naturalWidth)&&!e.hasAttribute("data-no-viewer")))}function show(t){a.isOpen=t,document.body.style.overflow=t?"hidden":"auto",t?e.classList.add("active"):e.classList.remove("active")}function resetTransform(){a.scale=1,a.translateX=0,a.translateY=0,a.activeImg&&(a.activeImg.style.transform="translate(0, 0) scale(1)",a.activeImg.style.cursor="grab")}function applyTransform(){a.activeImg&&(a.activeImg.style.transform=`translate(${a.translateX}px, ${a.translateY}px) scale(${a.scale})`)}function restoreActiveImage(){a.activeImg&&a.placeholder&&a.placeholder.replaceWith(a.activeImg),a.activeImg=null,a.placeholder=null,n.innerHTML=""}function mountImage(e){restoreActiveImage(),resetTransform();const t=document.createElement("span");t.className="image-viewer-placeholder",t.style.display="inline-block",t.style.width=`${e.width||e.clientWidth||0}px`,t.style.height=`${e.height||e.clientHeight||0}px`,e.before(t),n.appendChild(e),e.style.cursor="grab",a.activeImg=e,a.placeholder=t,a.dragged=!1}function openAt(e){a.items=function collectLoadedImages(){return Array.from(document.querySelectorAll(s)).filter((e=>e instanceof HTMLImageElement&&isViewableImg(e)))}(),a.currentIndex=a.items.indexOf(e),a.currentIndex<0&&(a.items=[e],a.currentIndex=0),mountImage(e),show(!0),document.addEventListener("keydown",onKeydown)}function close(){a.isOpen&&(document.removeEventListener("keydown",onKeydown),show(!1),resetTransform(),restoreActiveImage())}function navigate(e){if(!a.isOpen)return;if(a.items.length<=1)return;const t=(a.currentIndex+e+a.items.length)%a.items.length,n=a.items[t];n&&isViewableImg(n)&&(a.currentIndex=t,mountImage(n))}function onKeydown(e){a.isOpen&&("Escape"!==e.key?"ArrowLeft"!==e.key&&"ArrowUp"!==e.key?"ArrowRight"!==e.key&&"ArrowDown"!==e.key||navigate(1):navigate(-1):close())}function endDrag(e){a.isOpen&&a.activeImg&&(a.isMouseDown&&e.stopPropagation(),a.isMouseDown=!1,a.activeImg.style.cursor="grab")}e.addEventListener("click",(t=>{a.isOpen&&(a.dragged?a.dragged=!1:t.target!==e&&t.target!==n||close())})),document.addEventListener("click",(e=>{if(a.isOpen)return;const t=e.target;t instanceof HTMLImageElement&&t.matches(s)&&isViewableImg(t)&&openAt(t)}),!0),n.addEventListener("wheel",(e=>{if(!a.isOpen||!a.activeImg)return;e.preventDefault();const t=a.activeImg.getBoundingClientRect(),n=e.clientX-t.left,s=e.clientY-t.top,i=n-t.width/2,r=s-t.height/2,o=a.scale;a.scale+=-.001*e.deltaY,a.scale=Math.min(Math.max(.8,a.scale),4),o<a.scale?(a.translateX-=i*(a.scale-o),a.translateY-=r*(a.scale-o)):(a.translateX=0,a.translateY=0),applyTransform()}),{passive:!1}),n.addEventListener("mousedown",(e=>{a.isOpen&&a.activeImg&&(e.preventDefault(),a.isMouseDown=!0,a.lastMouseX=e.clientX,a.lastMouseY=e.clientY,a.activeImg.style.cursor="grabbing")}),{passive:!1}),n.addEventListener("mousemove",(e=>{if(!a.isOpen||!a.activeImg)return;if(!a.isMouseDown)return;const t=e.clientX-a.lastMouseX,n=e.clientY-a.lastMouseY;a.translateX+=t,a.translateY+=n,a.lastMouseX=e.clientX,a.lastMouseY=e.clientY,a.dragged=!0,applyTransform()}),{passive:!1}),n.addEventListener("mouseup",endDrag,{passive:!1}),n.addEventListener("mouseleave",endDrag,{passive:!1})}
//# sourceMappingURL=imageViewer.js.map